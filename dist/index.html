<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>PDF Viewer Example</title>
        <script defer="defer" src="pdf.js"></script>
        <script defer="defer" src="pdf_viewer.js"></script>
        <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.css" />
        <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
        <style>
            body {
                margin: 0;
                padding: 0;
            }

            html,
            body {
                height: 100%;
                position: relative;
            }

            .layout-fill {
                margin: 0;
                width: 100%;
                min-height: 100%;
                height: 100%;
            }
            .layout-column {
                -webkit-box-orient: vertical;
                -webkit-box-direction: normal;
                flex-direction: column;
            }
            .layout,
            .layout-column,
            .layout-row {
                box-sizing: border-box;
                display: -webkit-box;
                display: flex;
            }
            .flex {
                -webkit-box-flex: 1;
                flex: 1;
                box-sizing: border-box;
            }
            .layout-align-start-center,
            .layout-align-center-center,
            .layout-align-end-center,
            .layout-align-space-between-center,
            .layout-align-space-around-center {
                -webkit-box-align: center;
                align-items: center;
                align-content: center;
                max-width: 100%;
            }

            .layout-align-center,
            .layout-align-center-start,
            .layout-align-center-center,
            .layout-align-center-end,
            .layout-align-center-stretch {
                -webkit-box-pack: center;
                justify-content: center;
            }

            #pdfviewer-slide-wrapper-container {
                width: 100% !important;
                overflow: hidden !important;
            }

            #pdfviewer-slide-wrapper-container .swiper-wrapper {
                margin: 0 auto !important;
            }

            #pdfviewer-slide-wrapper-container.viewerContainer {
                position: relative;
                width: 100%;
                height: 100%;
            }

            #pdfviewer-coverflow-wrapper-container.viewerContainer {
                position: relative;
                width: 100%;
                height: 100%;
            }

            .viewerContainer {
                overflow: visible !important;
            }

            .page {
                border: 0 !important;
            }
            .page div {
                margin: 0 auto;
            }

            .annotationLayer {
                position: absolute;
            }

            .swiper-wrapper {
                align-items: center; /* add this will all relevant prefixes */
            }
        </style>
    </head>

    <body>
        <!-- <div id="pdfviewer-cube-wrapper-container" class="swiper viewerContainer">
            <div class="pdfViewer swiper-wrapper"></div>
        </div>
        <div class="swiper-button-prev"></div>
        <div class="swiper-button-next"></div> -->

        <div class="flex layout-fill layout-column layout-align-center-center">
            <div id="pdfviewer-slide-wrapper-container" class="swiper viewerContainer">
                <div class="pdfViewer swiper-wrapper"></div>
            </div>
            <div class="swiper-button-prev"></div>
            <div class="swiper-button-next"></div>
        </div>

        <!-- <div class="flex layout-fill layout-column layout-align-center-center">
            <div id="pdfviewer-coverflow-wrapper-container" class="swiper viewerContainer">
                <div class="pdfViewer swiper-wrapper"></div>
            </div>
            <div class="swiper-button-prev"></div>
            <div class="swiper-button-next"></div>
        </div> -->

        <!-- <div id="pdfviewer-fade-wrapper-container" class="swiper viewerContainer">
            <div class="pdfViewer swiper-wrapper"></div>
        </div>
        <div class="swiper-button-prev"></div>
        <div class="swiper-button-next"></div> -->

        <!-- <div id="rt-cards-wrapper">
      <div
        id="pdfviewer-cards-wrapper-container"
        class="swiper viewerContainer"
      >
        <div class="pdfViewer swiper-wrapper"></div>
      </div>
      <div class="swiper-button-prev"></div>
      <div class="swiper-button-next"></div>
    </div>

    



    <div id="rt-flip-wrapper">
      <div id="pdfviewer-flip-wrapper-container" class="swiper viewerContainer">
        <div class="pdfViewer swiper-wrapper"></div>
      </div>
      <div class="swiper-button-prev"></div>
      <div class="swiper-button-next"></div>
    </div>

    <div id="rt-creative-wrapper">
      <div
        id="pdfviewer-creative-wrapper-container"
        class="swiper viewerContainer"
      >
        <div class="pdfViewer swiper-wrapper"></div>
      </div>
      <div class="swiper-button-prev"></div>
      <div class="swiper-button-next"></div>
    </div> -->

        <script>
            class SwiperPDF {
                PDFViewer = window.rtPDFViewer;
                rtContainerId = null;
                containerId = null;
                effect = null;
                swiper = null;
                constructor(effect = 'slide') {
                    this.effect = effect;
                    this.rtContainerId = `rt-${this.effect}-wrapper`;
                    this.containerId = `pdfviewer-${this.effect}-wrapper-container`;
                    this.initPDFViewer();
                }

                render = () => {
                    return new Promise((resolve) => {
                        // NEED this on
                        //
                        // swiper.style.width = page.style.width;
                        // swiper.style.height = page.style.height;
                        //
                        // this.PDFViewer.eventBus.on('resize', (val) => {
                        //     const swiper = document.querySelector(`#${this.containerId}.swiper`);
                        //     swiper.style.width = '';
                        //     swiper.style.height = '';
                        //     swiper.style.opacity = 0;
                        //     let self = this;
                        //     setTimeout(function () {
                        //         swiper.style.height = self.swiper.slides[self.swiper.activeIndex].clientHeight + 'px';
                        //         swiper.style.width = self.swiper.slides[self.swiper.activeIndex].clientWidth + 'px';
                        //         swiper.style.opacity = 1;
                        //     }, 200);
                        //     console.log('w_h', this.swiper, this.PDFViewer);
                        // });
                        this.PDFViewer.eventBus.on('pagesloaded', (val) => {
                            if (val.source.container.id === this.containerId) {
                                setTimeout(() => {
                                    this.initSwiper({
                                        afterInit: resolve
                                    });
                                });
                            }
                        });
                    });
                };

                initPDFViewer() {
                    this.PDFViewer.initialize({
                        removePageBorders: true,
                        containerId: this.containerId,
                        currentScaleValue: 'auto'
                    });

                    this.PDFViewer.open('tech.pdf');
                }

                initSwiper(eventBus) {
                    let that = this;
                    const swiper = document.querySelector(`#${that.containerId}.swiper`);
                    const pages = document.querySelectorAll(`#${that.containerId} .page`);

                    pages.forEach((page) => {
                        page.classList.add('swiper-slide');
                        //swiper.style.width = page.style.width;
                        //swiper.style.height = page.style.height;
                    });

                    const conf = {
                        // centeredSlides: true,
                        // centeredSlidesBounds: true,
                        on: eventBus,
                        effect: that.effect,
                        grabCursor: true,
                        navigation: {
                            nextEl: `.swiper-button-next`,
                            prevEl: `.swiper-button-prev`
                        },
                        keyboard: {
                            enabled: true,
                            onlyInViewport: true
                        },
                        on: {
                            init: (swiper) => {
                                // swiper.slideTo(2, 0);
                            },
                            beforeTransitionStart: (swiper) => {
                                console.log('this.swiper', swiper);
                                rtPDFViewer.page = swiper.activeIndex + 1;
                                that.PDFViewer.updateSlide();
                            },
                            slideChangeTransitionEnd: (swiper) => {}
                        }
                    };

                    if (that.effect === 'creative') {
                        conf.creativeEffect = {
                            prev: {
                                shadow: true,
                                origin: 'left center',
                                translate: ['-5%', 0, -200],
                                rotate: [0, 100, 0]
                            },
                            next: {
                                origin: 'right center',
                                translate: ['5%', 0, -200],
                                rotate: [0, -100, 0]
                            }
                        };
                    }

                    console.log('conf', conf);

                    that.swiper = new Swiper(`#${this.containerId}.swiper`, conf);
                }
            }

            document.addEventListener('DOMContentLoaded', async () => {
                await new SwiperPDF('slide').render();
                // await new SwiperPDF("cards").render();
                // await new SwiperPDF('fade').render();
                // await new SwiperPDF('cube').render();
                // await new SwiperPDF("flip").render();
                // await new SwiperPDF('coverflow').render();
                // await new SwiperPDF('creative').render();
            });
        </script>
    </body>
</html>
